<html>

<head>
    <title>Processor Testing</title>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
    <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>


    <script
        src="https://www.paypal.com/sdk/js?client-id=AYidKuTmO-c-5kUElRNtNin579BxO3G6dzYK9rLuY0AUp01QY67KZTRXWedVDAHYdhE7IvgPuWDtBqfq&intent=capture"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="/stylesheets/paypal_hf.css">
    <style>
        .navigation {
            display: flex;
            flex-flow: row wrap;
            justify-content: flex-end;
            align-items: flex-end;
            list-style: none;
            gap: 10px;
        }
    </style>
</head>

<body>
    <div class="ui basic segment">
        <div class="ui segments">
            <div class="ui segment"></div>
            <div class="ui horizontal segments">
                <div class="ui segment"></div>
                <div class="ui segment"></div>
                <div class="ui segment"></div>
            </div>
            <div class="ui segment"></div>
        </div>
        <div class="ui top attached steps">
            <a class="step">
                <div class="content">
                    <div class="title">Step</div>
                    <div class="description">Description</div>
                </div>
            </a>
            <a class="step">
                <div class="content">
                    <div class="title">Step</div>
                    <div class="description">Description</div>
                </div>
            </a>
            <a class="step">
                <div class="content">
                    <div class="title">Step</div>
                    <div class="description">Description</div>
                </div>
            </a>
            <a class="step">
                <div class="content">
                    <div class="title">Step</div>
                    <div class="description">Description</div>
                </div>
            </a>
            <a class="active step">
                <div class="content">
                    <div class="title">Step</div>
                    <div class="description">Description</div>
                </div>
            </a>
        </div>
        <div class="ui attached block header">
            <i class="settings icon"></i>
            <div class="content"> Color
                <div class="sub header">Sub-header</div>
            </div>
        </div>
        <div class="ui attached center aligned segment">
            <div class="ui button">A</div>
            <div class="ui horizontal divider">and</div>
            <div class="teal ui button">B</div>
        </div>
        <div class="ui attached menu">
            <a class="item">
                <i class="gamepad icon"></i> Games </a>
            <a class="item">
                <div class="floating ui teal label">11</div>
                <i class="video camera icon"></i> Channels
            </a>
            <a class="item">
                <div class="floating ui red label">5</div>
                <i class="video play icon"></i> Videos
            </a>
        </div>
        <div class="ui attached segment">
            <a class="ui ribbon red label">Ribbon</a>
            <div class="ui top right attached label">Top Right</div>
            <div class="ui buttons">
                <div class="ui button">Cancel</div>
                <div class="or"></div>
                <div class="ui positive button">Save</div>
            </div>
            <div class="ui icon buttons">
                <div class="ui button">
                    <i class="align left icon"></i>
                </div>
                <div class="ui button">
                    <i class="align center icon"></i>
                </div>
                <div class="ui button">
                    <i class="align right icon"></i>
                </div>
                <div class="ui button">
                    <i class="align justify icon"></i>
                </div>
            </div>
            <div class="ui success message">
                <div class="content">
                    <div class="header">Positive Message</div>
                    <p>Example description</p>
                </div>
            </div>
        </div>
        <table class="ui celled striped attached table">
            <thead>
                <tr>
                    <th colspan="3"> Files </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="disabled">
                        <i class="folder icon"></i> folder
                    </td>
                    <td>Comment</td>
                    <td class="right aligned collapsing">10 hours ago</td>
                </tr>
                <tr>
                    <td>
                        <i class="folder icon"></i> folder2
                    </td>
                    <td>Comment</td>
                    <td class="right aligned">10 hours ago</td>
                </tr>
                <tr>
                    <td>
                        <i class="folder icon"></i> folder3
                    </td>
                    <td>Comment</td>
                    <td class="right aligned">10 hours ago</td>
                </tr>
                <tr>
                    <td class="collapsing">
                        <i class="file outline icon"></i> package.json
                    </td>
                    <td>Comment</td>
                    <td class="right aligned">10 hours ago</td>
                </tr>
                <tr>
                    <td>
                        <i class="file outline icon"></i> Gruntfile.js
                    </td>
                    <td>Comment</td>
                    <td class="right aligned">10 hours ago</td>
                </tr>
            </tbody>
        </table>
        <div class="ui attached loading segment">
            <br />
            <br />
            <br />
        </div>
        <div class="ui secondary attached segment">
            <div class="ui breadcrumb">
                <a class="section">Home</a>
                <div class="divider"> / </div>
                <a class="section">Store</a>
                <div class="divider"> / </div>
                <div class="active section">T-Shirt</div>
            </div>
        </div>
        <div class="ui warning form attached segment">
            <div class="ui warning message">
                <div class="header">Warning Message</div>
                <ul class="list">
                    <li>Problem #1</li>
                    <li>Problem #2</li>
                </ul>
            </div>
            <div class="two fields">
                <div class="field">
                    <label>Input</label>
                    <input placeholder="Text Input" type="text">
                </div>
                <div class="field">
                    <label>Input</label>
                    <input placeholder="Text Input" type="text">
                </div>
            </div>
            <div class="ui submit button">Submit</div>
        </div>
        <div class="ui two column stackable center aligned grid attached segment">
            <a class="ui red right corner label">
                <i class="close icon"></i>
            </a>
            <div class="column">
                <div class="ui button">A</div>
            </div>
            <div class="ui vertical divider">or</div>
            <div class="column">
                <div class="teal ui button">B</div>
            </div>
        </div>
        <div class="ui bottom attached buttons">
            <div class="ui basic red button">Test</div>
            <div class="ui basic red button">
                <div class="ui statistic">
                    <div class="label"> Top Label </div>
                    <div class="value"> 4:05 </div>
                </div>
            </div>
            <div class="ui basic yellow loading button">Test</div>
        </div>
    </div>
</body>
<script>

    const uuidv4 = () => {
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
            var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
            return v.toString(16);
        });
    }

    const uuid = uuidv4();

    paypal
        .Buttons({
            // Sets up the transaction when a payment button is clicked
            createOrder: function (data, actions) {
                console.log('Creating the order!');
                return fetch("/v2/orders", {
                    method: 'post',
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: `{
                            "intent": "CAPTURE",
                            "purchase_units": [
                                {
                                    "reference_id": "${uuid}",
                                    "amount": {
                                        "currency_code": "USD",
                                        "value": "10.00"
                                    }
                                }
                            ]
                        }`
                }).then((res) => res.json()
                ).then((json) => {
                    console.log('Create order response: ', json);
                    orderId = json.id; // needed later to complete capture
                    return orderId;
                })
            },
            // Finalize the transaction after payer approval
            onApprove: function (data, actions) {
                console.log('onApprove invoked with data: ', data);
                console.log(`attempting to capture the order with order id ${data.orderID}`);
                return fetch(`/v2/orders/${data.orderID}/capture`, {
                    method: "post",
                    body: `{}`
                })
                    .then((response) => response.json())
                    .then((json) => {
                        // Log the capture response
                        console.log('Capture Response: ', json);

                        // show or hide forms
                        $("#paymentForm").hide();
                        $("#finalForm").show();

                        // update the "steps"
                        $("#stepOne").removeClass("active");
                        $("#stepTwo").addClass("active");

                        // Show a success message or redirect
                        let message = `A transaction with id #${json.id} in the amount of $${json.purchase_units[0].amount.value} ${json.purchase_units[0].amount.currency_code} was processed sucessfully.`;
                        presentInfoMessage("Transaction completed!", message);
                    });
            },
        })
        .render("#paypal-button-container");


    /***************************************************/
    /****************** GENERAL UTILS ******************/
    /***************************************************/
    function presentInfoMessage(header, message) {
        $("#infoMessage .header").html(header);
        $("#infoMessageContent").html(message);
        $('#infoMessage').show();
    }

    function presentError(header = 'General Error', error, debug = false) {
        $("#errorMessageHeader").html(header);
        $("#errorMessageContent").html(error.message);
        if (debug) {
            $("#errorStack").html(error.stack);
        }
        $("#errorMessage").show();
    }

    // update the menu bar selected item
    $('.item').click(function (event) {
        console.log('item: ', event);
        $('.item').removeClass('active');
        $(this).addClass('active');
    });

    $("#home, #cancel, #cancel2, #cancel3").click(function () {
        /* function goes in here */
        location.reload()
    });

    $('.ui.accordion')
        .accordion()
        ;

    $('.ui.dropdown')
        .dropdown(this)
        // console.log("Dropdown: ", JSON.stringify(this));
        ;

    $('.message .close')
        .on('click', function () {
            $("#errorMessage").hide();
            $('#infoMessage').hide();
        });
</script>>

</html>